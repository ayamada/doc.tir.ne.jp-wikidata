---
toc: yes
title: gititメモ
categories: gitit
...

このdoc.tir.ne.jpは、[gitit]を使って構築しています。

このページでは、その[gitit]のノウハウやメモを書いていきます。

[gitit]: http://gitit.net/


# 使った感想

あとで！


# 一般的な情報

- gititの読み方は「ぎちっと」でいいのか？

- wikinameはそのままページのURLになってしまうので、これはURL encodeされない文字だけで構成するのがいいようだ。
    - ページのメタ情報のところに「title: ページのタイトル」と入れておけば、このタイトルがwikinameの代わりに正式なタイトルとして使われるので、この機能を多用する。


- gititで利用できるmarkdown書式は、通常のものよりも拡張された [Pandoc's markdown](http://johnmacfarlane.net/pandoc/README.html#pandocs-markdown) との事。
    - なので、エディタの書式設定も、通常のmarkdownではなく、pandoc用のものがベター。

- /\_reloadTemplates にアクセスすると、サーバを再起動しなくてもページテンプレート(\*.st)が再読込される。よく変更するならsitenavi.stあたりに含めておくと便利

- 各ページ内の見出しは、以下のルールでanchor(#fragment)化される様子。リンクを貼る時に「とりあえずなんか変換が入る」とだけ憶えておけばok
    - アルファベットは全て小文字に
    - spaceは「-」に置換
    - マルチバイト文字はそのまま


## readonly運用時の情報

- gititをreadonlyにするには、「require-authentication: modify」にした上で「authentication-method: mzero」にすればよい
    - 要は「ログインした人のみ編集可」にした上で「誰もログインできない認証モジュールを選択」の状態にしている

- gititで通常のウェブサイト的運用を行う場合のノウハウ
    - ページ編集機能のみならず「全ページ一覧」「カテゴリ一覧」等のwiki的機能も不要ならば、reverse-proxy設定で「/\_ ではじまるpathはアクセス不可にする」設定にしてしまっていいと思う
        - これで問題になるのは、検索機能である「\_search」とフィード購読である「\_feed」。
            - 検索のみreverse-proxy設定で例外的に許可してもいいと思う。
            - フィード購読の方はそもそもgitの変更履歴が出るものなのであまり役に立たないので機能ごと切ってもいいかも。


## 不具合対策的な情報

- gitit.confで use-cache: yes にすると、リポジトリ直更新による内容更新がキャッシュに反映されない。
    - 「expireGititCache」コマンドが、gititコマンドと同じ場所にインストールされているので、それを叩くようにすればok
        - しかしこれ、各ページを個別に指定する必要があるのでちょっと面倒。もっと簡単にできないか考えたい

- どうも、ページ編集時に一回余分にhtml実体参照のアンエスケープ処理が入っているらしく、「＆ａｍｐ；ａｍｐ；ａｍｐ；ａｍｐ；ａｍｐ；」のように書いておいて別のところを編集していくと、徐々に短くなっていき最終的には「＆」だけになってしまう
    - この問題は他の「＆＊＊＊＊＊；」や「＆＃ｎｎ；」でも発生する
    - Happstackに問題がある？
        - 可能なら自分で調べて直して、pull-requestを送る
- リスト項目の中で「￥＜！－－　　－－￥＞」を書くと、それ以降の文章がリスト項目の子要素にされてしまう
    - これも可能なら自分で調べて直して、pull-requestを送る


# 導入手順など

あとで！


# 外部リンク

- [http://utotch.blogspot.jp/2011/12/pandoc-blogger.html]() pandocについての記事


# doc.tir.ne.jp 固有の情報

- 今入っているgititのバージョンは、 gitit version 0.10.0.1 +plugins


## 構成

書き込み可能な内部用gititと、readonlyな公開用gititの2サービス構成です。

続きはあとで


# TODO

TODOが完了したら、下の「完了したTODO」に移動させるか、上の各項目のどれかに反映するか、ちゃんと処理する事。

- 可能なら自分で新たに「\$hoge\$」タグを追加して、docとintraのテンプレートを完全に共通化させたいので、可能かどうか調べる
    - とりあえず、class="public-only" class="intra-only"を用意して、cssレベルで区別だけしては？
        - css自体も共通にしたいので、もうちょっと考える必要はあるが…
    - 他にも変数で変更したい部分はあるので調査自体は行う。面倒ならもう「\$if(feed)\$」等の他の用途の変数を流用する事を考える
    - これはpandocのtemplate機能らしい→ http://johnmacfarlane.net/pandoc/README.html#templates

- ExportのSlidyを動くようにする。それができないなら「\$exportbox\$」から抜く方法を考える

- \*.st内における、httpからはじまるfull urlの出し方を調べ、pagetool.stのbingのところに反映
    - 調べた結果、取れるインターフェースはないようだ…
        - デフォルトではhostnameシステムコールで取るらしい
        - どうしても取りたいなら自分でプラグイン作ってHost: ヘッダから取るしかなさそう

- 編集サイトのみ、左サイドバー内のどこかに、「公開サイトと編集サイトの違い」「同期方法」「うっかり編集サイトのURLを外に貼らないよう注意！」等々の説明書きをする事を考える

- 日本語のmarkdown記法の解説ページ(可能ならpandoc版のもの)へのリンクを左サイドバーに追加する

- サブディレクトリなwikinameのところに「..」相当のリンクをつけたい
    - gititのモジュール書いてやってみる
    - しかしどうも、gititでは「/dir」と「/dir/」の扱いが違い、「/dir/child」があるからといって「/dir」があるとは限らないので(「/dir/」はあるが)、安易に「..」相当のリンクを貼れないっぽいようだ。モジュール作らずに手で貼った方がいい？
        - しかし、doc.tir.ne.jpに限れば、「/dir/child」を書く時は「/dir」も書くルールで運用する、という事なら、モジュール作ってしまった方がいいと思う

- Recent changes とかの日時をUTCじゃなくJSTにしたい

- doc.tir.ne.jp向けのカスタマイズを行ったテンプレート等も、githubにリポジトリを作って、保存しても問題ない部分については保存してしまう
    - 勿論、パスワード等の設定部分は除外する

- categories: tir.ne.jp を各ページにつけてまわる

- がんばってcssを独自作成する？

- このページはちょっとごちゃごちゃしているので、もうちょっと読みやすいようにしたい
    - doc.tir.ne.jp固有の情報はページ分けた方がいいと思う。あとで分ける事
    - このTODO自体も同時に移動させたい


# 完了したTODO

あとで


<!-- vim:set ft=markdown ts=4 sts=4 sw=4 et: -->
